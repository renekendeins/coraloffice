{% extends 'users/base.html' %}

{% block users_title %}Medical Questionnaire - CoralOffice{% endblock %}

{% block users_content %}
<div class="container-fluid" style="max-width: 800px; margin: 0 auto; padding: 15px;">
    <div class="text-center mb-4">
        <h2 class="mb-3" id="form-title">Diving Medical Questionnaire</h2>
        {{ form.errors }}
        <p class="text-muted" id="form-subtitle">Please complete this form before your diving activity. All information is confidential.</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-danger{% endif %} mb-3">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <form method="post" class="bg-light p-3 p-md-4 rounded">
        {% csrf_token %}

        <!-- Language Selection -->
        <div class="row mb-4">
            <div class="col-12 text-end">
                <label for="{{ form.language.id_for_label }}" class="form-label me-2" id="language-label">Language / Idioma / Langue / Sprache / Taal:</label>
                {{ form.language }}
            </div>
        </div>

        <!-- Personal Information -->
        <fieldset class="border border-2 p-3 p-md-4 mb-4 rounded">
            <legend class="fw-bold text-secondary px-2 mb-3" id="personal-info-legend">Personal Information</legend>

            <div class="row g-3 mb-3">
                <div class="col-12 col-md-6">
                    <div class="form-group">
                        <label for="{{ form.first_name.id_for_label }}" class="form-label" id="first-name-label">First Name *</label>
                        {{ form.first_name }}
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="form-group">
                        <label for="{{ form.last_name.id_for_label }}" class="form-label" id="last-name-label">Last Name *</label>
                        {{ form.last_name }}
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-12 col-md-6">
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}" class="form-label" id="email-label">Email *</label>
                        {{ form.email }}
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="form-group">
                        <label for="{{ form.phone_number.id_for_label }}" class="form-label" id="phone-label">Phone Number *</label>
                        {{ form.phone_number }}
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label for="{{ form.birthday.id_for_label }}" class="form-label" id="birthday-label">Date of Birth *</label>
                        {{ form.birthday }}
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label for="{{ form.country.id_for_label }}" class="form-label" id="country-label">Country</label>
                        {{ form.country }}
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label for="{{ form.certification_level.id_for_label }}" class="form-label" id="certification-label">Diving Certification</label>
                        {{ form.certification_level }}
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label for="{{ form.weight.id_for_label }}" class="form-label" id="weight-label">Weight (kg)</label>
                        {{ form.weight }}
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label for="{{ form.height.id_for_label }}" class="form-label" id="height-label">Height (cm)</label>
                        {{ form.height }}
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <div class="form-group">
                        <label for="{{ form.foot_size.id_for_label }}" class="form-label" id="foot-size-label">Foot Size (EU)</label>
                        {{ form.foot_size }}
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="{{ form.default_tank_size.id_for_label }}" class="form-label" id="default-tank-size-label">Default Tank Size</label>
                {{ form.default_tank_size }}
            </div>
            <div class="form-group">
                <label for="{{ form.emergency_contact.id_for_label }}" class="form-label" id="emergency-contact-label">Emergency Contact *</label>
                {{ form.emergency_contact }}
            </div>
        </fieldset>

        <!-- Medical Questions -->
        <fieldset class="border border-danger border-2 p-3 p-md-4 mb-4 rounded">
            <legend class="fw-bold text-danger px-2 mb-3" id="medical-legend">Medical Questionnaire</legend>
            <p class="text-muted mb-3 fst-italic" id="medical-subtitle">
                Please answer ALL questions honestly. Your safety depends on it. If you answer YES to any question, provide details in the additional information section at the end.
            </p>
            <div class="mt-2 form-medical">
                <div class="question-section mb-3 p-3 border rounded">
                    <div class="d-flex flex-column flex-wrap p-2 bg-light rounded">
                        <div class="d-flex flex-column">
                            <div class="d-flex">
                                <div class="fw-bold me-2">1</div>
                                <div class="fw-bold flex-grow-1" id="question-1">I have had problems with my lungs/breathing, heart or blood</div>
                            </div>
                           <div class="d-flex">
                                {{ form.pregunta_1 }}
                           </div>
                        </div>
                    </div>

                    <div class="mt-3 p-2 bg-secondary text-white fw-bold" id="have-had-header">I HAVE / HAVE HAD:</div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-1-1">Chest surgery, heart surgery, heart valve surgery, stent placement, or pneumothorax (collapsed lung).</div>
                            {{ form.pregunta_1_1 }} 
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-1-2">Asthma, wheezing, severe allergies, hay fever or congested airways in the last 12 months that limit my physical activity/exercise.</div>
                            {{ form.pregunta_1_2 }}

                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-1-3">A heart problem or disease involving my heart such as: angina, chest pain on exertion, heart failure, pulmonary edema, cardiomyopathy or stroke, or I am taking medications for any heart condition.</div>
                            {{ form.pregunta_1_3 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-1-4">Recurrent bronchitis and persistent cough in the last 12 months or I have been diagnosed with emphysema.</div>
                            {{ form.pregunta_1_4 }}
                        </div>
                    </div>
                </div>

                <!-- Continue with remaining questions using the same pattern -->
                <!-- Question 2 -->
                <div class="question-section mb-3 p-3 border rounded bg-light">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-white rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">2</div>
                            <div class="fw-bold flex-grow-1" id="question-2">I am over 45 years old.</div>
                        </div>
                        {{ form.pregunta_2.0 }}
                    </div>

                    <div class="mt-3 p-2 bg-secondary text-white fw-bold" id="over-45-header">I AM OVER 45 AND:</div>

                    <!-- Add all sub-questions for question 2 -->
                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-2-1">Currently smoke or inhale nicotine by other means.</div>
                            {{ form.pregunta_2_1 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-2-2">I have a high cholesterol level.</div>
                            {{ form.pregunta_2_2 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-2-3">I have high blood pressure.</div>
                            {{ form.pregunta_2_3 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-2-4">I have had a family member (1st or 2nd degree relative) who died of sudden death or heart disease or stroke before age 50 or I have a family history of heart disease before age 50 (including abnormal heart rhythms, coronary artery disease, or cardiomyopathy).</div>
                             {{ form.pregunta_2_4 }}
                        </div>
                    </div>
                    <!-- Continue with remaining sub-questions... -->
                    <!-- For brevity, I'll add just the structure. Add all remaining questions following the same pattern -->
                </div>

                <div class="question-section mb-3 p-3 border rounded">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-light rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">3</div>
                            <div class="fw-bold flex-grow-1" id="question-3">I find it difficult to perform moderate exercise (e.g., walk 1.6 kilometers/one mile in 12 minutes or swim 200 meters/yards without resting), or I have not been able to participate in normal physical activity due to fitness or health reasons in the last 12 months.</div>
                        </div>
                        {{ form.pregunta_3 }}

                    </div>
                </div>

                <div class="question-section mb-3 p-3 border rounded bg-light">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-white rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">4</div>
                            <div class="fw-bold flex-grow-1" id="question-4">I have had problems with my eyes, ears, or sinuses/nasal passages.</div>
                        </div>
                        {{ form.pregunta_4 }}
                    </div>
                    <div class="mt-3 p-2 bg-secondary text-white fw-bold" id="have-had-header-4">I HAVE / HAVE HAD:</div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-4-1">Sinus surgery in the last 6 months.</div>
                            {{ form.pregunta_4_1 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-4-2">Ear diseases or ear surgery, hearing loss, or balance disturbances.</div>
                            {{ form.pregunta_4_2 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-4-3">Recurrent sinusitis in the last 12 months.</div>
                            {{ form.pregunta_4_3 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-4-4">Eye surgery in the last 3 months.</div>
                            {{ form.pregunta_4_4 }}
                        </div>
                    </div>
                </div>

                <div class="question-section mb-3 p-3 border rounded">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-light rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">5</div>
                            <div class="fw-bold flex-grow-1" id="question-5">I have had surgery in the last 12 months or have ongoing problems related to previous surgery.</div>
                        </div>
                        {{ form.pregunta_5 }}
                    </div>
                </div>

                <div class="question-section mb-3 p-3 border rounded bg-light">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-white rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">6</div>
                            <div class="fw-bold flex-grow-1" id="question-6">I have lost consciousness, had migraine headaches, seizures, stroke, significant head injury, or have suffered from persistent neurological injury or illness.</div>
                        </div>
                        {{ form.pregunta_6 }}
                    </div>
                    <div class="mt-3 p-2 bg-secondary text-white fw-bold" id="have-had-header-6">I HAVE / HAVE HAD:</div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-6-1">Head injury with loss of consciousness in the last 5 years.</div>
                            {{ form.pregunta_6_1 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-6-2">Persistent neurological injuries or illnesses.</div>
                            {{ form.pregunta_6_2 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-6-3">Recurrent migraine headaches in the last 12 months or I take medication to prevent them.</div>
                            {{ form.pregunta_6_3 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-6-4">Fainting or blackouts (total/partial loss of consciousness) in the last 5 years.</div>
                            {{ form.pregunta_6_4 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-6-5">Epilepsy, seizures, or convulsions, or I take medication to prevent them.</div>
                            {{ form.pregunta_6_5 }}
                        </div>
                    </div>
                </div>

                <div class="question-section mb-3 p-3 border rounded">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-light rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">7</div>
                            <div class="fw-bold flex-grow-1" id="question-7">I have had psychological problems (or have received psychological treatment in the last 5 years), been diagnosed with a learning disability, personality disorder, panic attacks, or a drug or alcohol addiction.</div>
                        </div>
                        {{ form.pregunta_7 }}
                    </div>
                    <div class="mt-3 p-2 bg-secondary text-white fw-bold" id="have-had-header-7">I HAVE / HAVE HAD:</div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-7-1">Behavioral health, mental or psychological problems requiring medical/psychiatric treatment.</div>
                            {{ form.pregunta_7_1 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-7-2">Major depression, suicidal tendency, panic attacks, uncontrolled bipolar disorder requiring medication/psychiatric treatment.</div>
                            {{ form.pregunta_7_2 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-7-3">I have been diagnosed with a mental health condition or a learning/developmental disorder that requires ongoing care.</div>
                            {{ form.pregunta_7_3 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-7-4">A drug or alcohol addiction requiring treatment in the last 5 years.</div>
                            {{ form.pregunta_7_4 }}
                        </div>
                    </div>
                </div>

                <div class="question-section mb-3 p-3 border rounded bg-light">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-white rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">8</div>
                            <div class="fw-bold flex-grow-1" id="question-8">I have had back problems, hernia, ulcers or diabetes.</div>
                        </div>
                        {{ form.pregunta_8 }}
                    </div>
                    <div class="mt-3 p-2 bg-secondary text-white fw-bold" id="have-had-header-8">I HAVE / HAVE HAD:</div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-8-1">Recurrent back problems in the last 6 months that limit my daily activity.</div>
                            {{ form.pregunta_8_1 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-8-2">Back or spinal surgery in the last 12 months.</div>
                            {{ form.pregunta_8_2 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-8-3">Diabetes, whether controlled by insulin or by diet or gestational diabetes in the last 12 months.</div>
                            {{ form.pregunta_8_3 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-8-4">An uncorrected hernia that limits my physical abilities.</div>
                            {{ form.pregunta_8_4 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-8-5">Active or untreated ulcers, problematic wounds, or ulcer surgery in the last 6 months.</div>
                            {{ form.pregunta_8_5 }}
                        </div>
                    </div>
                </div>

                <div class="question-section mb-3 p-3 border rounded">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-light rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">9</div>
                            <div class="fw-bold flex-grow-1" id="question-9">I have had stomach or bowel problems, including recent diarrhea.</div>
                        </div>
                        {{ form.pregunta_9 }}
                    </div>
                    <div class="mt-3 p-2 bg-secondary text-white fw-bold" id="have-had-header-9">I HAVE:</div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-9-1">Ostomy surgery and I am not medically cleared to swim or participate in physical activity.</div>
                            {{ form.pregunta_9_1 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-9-2">Dehydration requiring medical intervention in the last 7 days.</div>
                            {{ form.pregunta_9_2 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-9-3">Active or untreated stomach or intestinal ulcers or ulcer surgery in the last 6 months.</div>
                            {{ form.pregunta_9_3 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-9-4">Frequent heartburn, regurgitation, or gastroesophageal reflux disease (GERD).</div>
                            {{ form.pregunta_9_4 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 border-bottom">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-9-5">Active or uncontrolled ulcerative colitis or Crohn’s disease.</div>
                            {{ form.pregunta_9_5 }}
                        </div>
                    </div>

                    <div class="sub-question p-2 bg-light">
                        <div class="d-flex flex-wrap justify-content-between align-items-center">
                            <div class="flex-grow-1 pe-2" id="question-9-6">Bariatric surgery in the last 12 months.</div>
                            {{ form.pregunta_9_6 }}
                        </div>
                    </div>
                </div>

                <div class="question-section mb-3 p-3 border rounded bg-light">
                    <div class="d-flex flex-wrap align-items-center justify-content-between p-2 bg-white rounded">
                        <div class="d-flex align-items-start flex-grow-1">
                            <div class="fw-bold me-2">10</div>
                            <div class="fw-bold flex-grow-1" id="question-10">I am taking prescription medications (with the exception of birth control or anti-malarial drugs that are not Lariam-mefloquine).</div>
                        </div>
                        {{ form.pregunta_10 }}
                    </div>
                </div>
            </div>

            <div class="form-group mb-3">
                <label for="{{ form.swimming_ability.id_for_label }}" class="form-label" id="swimming-label">Swimming Ability *</label>
                {{ form.swimming_ability }}
            </div>

            <div class="form-group">
                <label for="{{ form.medical_conditions.id_for_label }}" class="form-label" id="additional-info-label">Additional Medical Information</label>
                {{ form.medical_conditions }}
                <small class="form-text text-muted" id="additional-info-help">Please provide details about any YES answers above, current medications, allergies, or other relevant medical information.</small>
            </div>
        </fieldset>

        <!-- Declaration -->
        <fieldset class="border border-success border-2 p-3 p-md-4 mb-4 rounded">
            <legend class="fw-bold text-success px-2 mb-3" id="declaration-legend">Declaration</legend>
            <div class="bg-light p-3 rounded">
                <p class="fw-bold mb-2" id="declaration-intro">I declare that:</p>
                <ul class="mb-0 ps-3" id="declaration-list">
                    <li id="declaration-1">All information provided is true and complete</li>
                    <li id="declaration-2">I understand that diving activities carry inherent risks</li>
                    <li id="declaration-3">I am physically and mentally fit to participate in diving activities</li>
                    <li id="declaration-4">I will inform the diving center of any changes to my medical condition</li>
                    <li id="declaration-5">I understand that this information will be kept confidential</li>
                </ul>
            </div>
        </fieldset>

        <div class="signature-container mb-3">
            <label for="signatureCanvas" class="form-label" id="signature-label">Signature</label>
            <canvas id="signatureCanvas" width="600" height="200" style="border:1px solid #000; width: 100%; max-width: 600px; touch-action: none;"></canvas>
            <button type="button" class="btn btn-sm btn-outline-secondary mt-2" id="clear-signature">Clear Signature</button>
            <input type="hidden" id="signatureImage" name="signature">
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-success btn-lg px-4 py-2" id="submit-button">Submit Medical Form</button>
        </div>
    </form>
</div>
                <style>
                .radio-option {
                  display: flex;
                    width: 100%;
                    justify-content: space-between;
                  align-items: center;
                  padding: 12px;
                  margin: 8px 0;
                  border: 2px solid #ccc;
                  border-radius: 12px;
                  background-color: #f9f9f9;
                  font-size: 1.1rem;
                  transition: border-color 0.2s, background-color 0.2s;
                }

                .radio-option input[type="radio"] {
                  accent-color: #007bff; /* bonito azul */
                  width: 20px;
                  height: 20px;
                  margin-right: 12px;
                  flex-shrink: 0;
                }

                .radio-option:hover {
                  border-color: #007bff;
                  background-color: #f0f8ff;
                }

                .radio-option input[type="radio"]:focus-visible {
                  outline: 3px solid #007bff;
                }

                .radio-option span {
                  flex-grow: 1;
                }
                .radio-option label{
                    display: flex !important;
                    margin-right: 20px;
                    align-items: center;
                }
                    
                </style>
<script>
// Translation dictionary
const translations = {
    'EN': {
        'form-title': 'Diving Medical Questionnaire',
        'form-subtitle': 'Please complete this form before your diving activity. All information is confidential.',
        'language-label': 'Language:',
        'personal-info-legend': 'Personal Information',
        'first-name-label': 'First Name *',
        'last-name-label': 'Last Name *',
        'email-label': 'Email *',
        'phone-label': 'Phone Number *',
        'birthday-label': 'Date of Birth *',
        'country-label': 'Country',
        'certification-label': 'Diving Certification',
        'weight-label': 'Weight (kg)',
        'height-label': 'Height (cm)',
        'foot-size-label': 'Foot Size (EU)',
        'emergency-contact-label': 'Emergency Contact *',
        'medical-legend': 'Medical Questionnaire',
        'medical-subtitle': 'Please answer ALL questions honestly. Your safety depends on it. If you answer YES to any question, provide details in the additional information section at the end.',
        'question-1': 'I have had problems with my lungs/breathing, heart or blood',
        'have-had-header': 'I HAVE / HAVE HAD:',
        'yes-label': 'Yes',
        'no-label': 'No',
        'swimming-label': 'Swimming Ability *',
        'additional-info-label': 'Additional Medical Information',
        'additional-info-help': 'Please provide details about any YES answers above, current medications, allergies, or other relevant medical information.',
        'declaration-legend': 'Declaration',
        'declaration-intro': 'I declare that:',
        'submit-button': 'Submit Medical Form',
        'signature-label': 'Signature' // Add signature label
    },
    'ES': {
        'form-title': 'Cuestionario Médico de Buceo',
        'form-subtitle': 'Por favor complete este formulario antes de su actividad de buceo. Toda la información es confidencial.',
        'language-label': 'Idioma:',
        'personal-info-legend': 'Información Personal',
        'first-name-label': 'Nombre *',
        'last-name-label': 'Apellido *',
        'email-label': 'Email *',
        'phone-label': 'Número de Teléfono *',
        'birthday-label': 'Fecha de Nacimiento *',
        'country-label': 'País',
        'certification-label': 'Certificación de Buceo',
        'weight-label': 'Peso (kg)',
        'height-label': 'Altura (cm)',
        'foot-size-label': 'Talla de Pie (EU)',
        'emergency-contact-label': 'Contacto de Emergencia *',
        'medical-legend': 'Cuestionario Médico',
        'medical-subtitle': 'Por favor responda TODAS las preguntas honestamente. Su seguridad depende de ello. Si responde SÍ a cualquier pregunta, proporcione detalles en la sección de información adicional al final.',
        'question-1': 'He tenido problemas con mis pulmones/respiración, corazón o sangre',
        'have-had-header': 'TENGO / HE TENIDO:',
        'yes-label': 'Sí',
        'no-label': 'No',
        'swimming-label': 'Habilidad de Natación *',
        'additional-info-label': 'Información Médica Adicional',
        'additional-info-help': 'Por favor proporcione detalles sobre cualquier respuesta SÍ anterior, medicamentos actuales, alergias u otra información médica relevante.',
        'declaration-legend': 'Declaración',
        'declaration-intro': 'Declaro que:',
        'submit-button': 'Enviar Formulario Médico',
        'signature-label': 'Firma' // Add signature label
    },
    'FR': {
        'form-title': 'Questionnaire Médical de Plongée',
        'form-subtitle': 'Veuillez remplir ce formulaire avant votre activité de plongée. Toutes les informations sont confidentielles.',
        'language-label': 'Langue:',
        'personal-info-legend': 'Informations Personnelles',
        'first-name-label': 'Prénom *',
        'last-name-label': 'Nom *',
        'email-label': 'Email *',
        'phone-label': 'Numéro de Téléphone *',
        'birthday-label': 'Date de Naissance *',
        'country-label': 'Pays',
        'certification-label': 'Certification de Plongée',
        'weight-label': 'Poids (kg)',
        'height-label': 'Taille (cm)',
        'foot-size-label': 'Pointure (EU)',
        'emergency-contact-label': 'Contact d\'Urgence *',
        'medical-legend': 'Questionnaire Médical',
        'medical-subtitle': 'Veuillez répondre à TOUTES les questions honnêtement. Votre sécurité en dépend. Si vous répondez OUI à une question, fournissez des détails dans la section d\'informations supplémentaires à la fin.',
        'question-1': 'J\'ai eu des problèmes avec mes poumons/respiration, cœur ou sang',
        'have-had-header': 'J\'AI / J\'AI EU:',
        'yes-label': 'Oui',
        'no-label': 'Non',
        'swimming-label': 'Capacité de Nage *',
        'additional-info-label': 'Informations Médicales Supplémentaires',
        'additional-info-help': 'Veuillez fournir des détails sur toute réponse OUI ci-dessus, médicaments actuels, allergies ou autres informations médicales pertinentes.',
        'declaration-legend': 'Déclaration',
        'declaration-intro': 'Je déclare que:',
        'submit-button': 'Soumettre le Formulaire Médical',
        'signature-label': 'Signature' // Add signature label
    },
    'DE': {
        'form-title': 'Medizinischer Fragebogen für Tauchen',
        'form-subtitle': 'Bitte füllen Sie dieses Formular vor Ihrer Tauchaktivität aus. Alle Informationen sind vertraulich.',
        'language-label': 'Sprache:',
        'personal-info-legend': 'Persönliche Informationen',
        'first-name-label': 'Vorname *',
        'last-name-label': 'Nachname *',
        'email-label': 'Email *',
        'phone-label': 'Telefonnummer *',
        'birthday-label': 'Geburtsdatum *',
        'country-label': 'Land',
        'certification-label': 'Tauchzertifizierung',
        'weight-label': 'Gewicht (kg)',
        'height-label': 'Größe (cm)',
        'foot-size-label': 'Schuhgröße (EU)',
        'emergency-contact-label': 'Notfallkontakt *',
        'medical-legend': 'Medizinischer Fragebogen',
        'medical-subtitle': 'Bitte beantworten Sie ALLE Fragen ehrlich. Ihre Sicherheit hängt davon ab. Wenn Sie JA zu einer Frage antworten, geben Sie Details im Zusatzinformationsbereich am Ende an.',
        'question-1': 'Ich hatte Probleme mit meiner Lunge/Atmung, Herz oder Blut',
        'have-had-header': 'ICH HABE / HATTE:',
        'yes-label': 'Ja',
        'no-label': 'Nein',
        'swimming-label': 'Schwimmfähigkeit *',
        'additional-info-label': 'Zusätzliche Medizinische Informationen',
        'additional-info-help': 'Bitte geben Sie Details zu JA-Antworten oben, aktuellen Medikamenten, Allergien oder anderen relevanten medizinischen Informationen an.',
        'declaration-legend': 'Erklärung',
        'declaration-intro': 'Ich erkläre, dass:',
        'submit-button': 'Medizinisches Formular Einreichen',
        'signature-label': 'Unterschrift' // Add signature label
    },
    'NL': {
        'form-title': 'Medische Vragenlijst voor Duiken',
        'form-subtitle': 'Vul dit formulier in voor uw duikactiviteit. Alle informatie is vertrouwelijk.',
        'language-label': 'Taal:',
        'personal-info-legend': 'Persoonlijke Informatie',
        'first-name-label': 'Voornaam *',
        'last-name-label': 'Achternaam *',
        'email-label': 'Email *',
        'phone-label': 'Telefoonnummer *',
        'birthday-label': 'Geboortedatum *',
        'country-label': 'Land',
        'certification-label': 'Duikcertificering',
        'weight-label': 'Gewicht (kg)',
        'height-label': 'Lengte (cm)',
        'foot-size-label': 'Schoenmaat (EU)',
        'emergency-contact-label': 'Noodcontact *',
        'medical-legend': 'Medische Vragenlijst',
        'medical-subtitle': 'Beantwoord ALLE vragen eerlijk. Uw veiligheid hangt ervan af. Als u JA antwoordt op een vraag, geef details in de aanvullende informatiesectie aan het einde.',
        'question-1': 'Ik heb problemen gehad met mijn longen/ademhaling, hart of bloed',
        'have-had-header': 'IK HEB / HAD:',
        'yes-label': 'Ja',
        'no-label': 'Nee',
        'swimming-label': 'Zwemvaardigheid *',
        'additional-info-label': 'Aanvullende Medische Informatie',
        'additional-info-help': 'Geef details over JA-antwoorden hierboven, huidige medicijnen, allergieën of andere relevante medische informatie.',
        'declaration-legend': 'Verklaring',
        'declaration-intro': 'Ik verklaar dat:',
        'submit-button': 'Medisch Formulier Indienen',
        'signature-label': 'Handtekening' // Add signature label
    },
     'CAT': {
        'form-title': 'Qüestionari Mèdic de Busseig',
        'form-subtitle': 'Si us plau, completeu aquest formulari abans de la vostra activitat de busseig. Tota la informació és confidencial.',
        'language-label': 'Idioma:',
        'personal-info-legend': 'Informació Personal',
        'first-name-label': 'Nom *',
        'last-name-label': 'Cognoms *',
        'email-label': 'Email *',
        'phone-label': 'Número de Telèfon *',
        'birthday-label': 'Data de Naixement *',
        'country-label': 'País',
        'certification-label': 'Certificació de Busseig',
        'weight-label': 'Pes (kg)',
        'height-label': 'Alçada (cm)',
        'foot-size-label': 'Mida de Peu (EU)',
        'emergency-contact-label': 'Contacte d\'Emergència *',
        'medical-legend': 'Qüestionari Mèdic',
        'medical-subtitle': 'Si us plau, responeu TOTES les preguntes honestament. La vostra seguretat en depèn. Si responeu SÍ a qualsevol pregunta, proporcioneu detalls a la secció d\'informació addicional al final.',
        'question-1': 'He tingut problemes amb els meus pulmons/respiració, cor o sang',
        'have-had-header': 'TINC / HE TINGUT:',
        'yes-label': 'Sí',
        'no-label': 'No',
        'swimming-label': 'Habilitat de Natació *',
        'additional-info-label': 'Informació Mèdica Addicional',
        'additional-info-help': 'Si us plau, proporcioneu detalls sobre qualsevol resposta SÍ anterior, medicaments actuals, al·lèrgies o altra informació mèdica rellevant.',
        'declaration-legend': 'Declaració',
        'declaration-intro': 'Declaro que:',
        'submit-button': 'Enviar Formulari Mèdic',
        'signature-label': 'Signatura'
    }
};

// Language change handler
document.getElementById('language-select').addEventListener('change', function() {
    const selectedLanguage = this.value;
    translateForm(selectedLanguage);
});

function translateForm(language) {
    const langTranslations = translations[language] || translations['EN'];

    // Update all elements with translation IDs
    Object.keys(langTranslations).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
            element.textContent = langTranslations[key];
        }
    });

    // Update radio button labels based on language
    const yesLabel = langTranslations['yes-label'] || 'Yes';
    const noLabel = langTranslations['no-label'] || 'No';

    // Update all radio button labels
    document.querySelectorAll('input[type="radio"]').forEach(radio => {
        const label = document.querySelector(`label[for="${radio.id}"]`);
        if (label) {
            const nodes = Array.from(label.childNodes);
            const textNode = nodes.find(n => n.nodeType === Node.TEXT_NODE);
            if (textNode) {
                textNode.textContent = (radio.value === '1') ? ' ' + yesLabel : ' ' + noLabel;
            }
        }
    });
}
    // Initialize with default language on page load
    document.addEventListener('DOMContentLoaded', function () {
        const selectedLanguage = document.getElementById('language-select').value;
        translateForm(selectedLanguage);

        // Signature Canvas Script
        const canvas = document.getElementById("signatureCanvas");
        const ctx = canvas.getContext("2d");
        let drawing = false;

        // Evita el scroll al tocar sobre el canvas (importante en móviles)
        ['touchstart', 'touchmove', 'touchend'].forEach(event => {
            canvas.addEventListener(event, e => e.preventDefault(), { passive: false });
        });

        function getCanvasCoords(e) {
            const rect = canvas.getBoundingClientRect();
            if (e.touches) {
                return {
                    x: e.touches[0].clientX - rect.left,
                    y: e.touches[0].clientY - rect.top
                };
            } else {
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
        }

        function startDrawing(e) {
            drawing = true;
            draw(e);
        }

        function stopDrawing() {
            drawing = false;
            ctx.beginPath();
        }

        function draw(e) {
            if (!drawing) return;

            const pos = getCanvasCoords(e);

            ctx.lineWidth = 2;
            ctx.lineCap = "round";
            ctx.strokeStyle = "black";

            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        // Mouse events
        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mouseout", stopDrawing);
        canvas.addEventListener("mousemove", draw);

        // Touch events
        canvas.addEventListener("touchstart", startDrawing);
        canvas.addEventListener("touchend", stopDrawing);
        canvas.addEventListener("touchmove", draw);

        // Clear signature button
        document.getElementById('clear-signature').addEventListener('click', function () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Save signature as image on form submit
        document.querySelector('form').addEventListener('submit', function (e) {
            const signatureImage = document.getElementById('signatureImage');
            signatureImage.value = canvas.toDataURL(); // Base64 encoded PNG
        });
    });

</script>

<style>
/* Medical Questions Responsive Grid */
.medical-questions-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

@media (min-width: 768px) {
    .medical-questions-grid {
        grid-template-columns: 1fr 1fr;
        gap: 15px 30px;
    }
}

.medical-question {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
    margin-bottom: 0;
}

.medical-question:hover {
    background: #e9ecef;
}

.medical-question input[type="checkbox"] {
    width: auto !important;
    margin: 0;
    transform: scale(1.2);
    flex-shrink: 0;
}

.medical-question span {
    font-weight: 500;
    color: #495057;
    flex: 1;
}

/* Ensure all form inputs are properly styled and responsive */
.form-control, .form-select {
    width: 100% !important;
    margin-bottom: 0;
}

.form-group {
    margin-bottom: 1rem;
}

.form-label {
    margin-bottom: 0.5rem;
    font-weight: 500;
}

/* Signature canvas styling */
.signature-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

#signatureCanvas {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

/* Mobile-specific adjustments */
@media (max-width: 767px) {
    .container-fluid {
        padding: 10px;
    }

    fieldset {
        padding: 15px !important;
    }

    .medical-question {
        padding: 10px;
    }

    .btn-lg {
        width: 100%;
        font-size: 1rem;
    }

    #signatureCanvas {
        width: 100% !important;
        height: 150px !important;
    }
}
</style>
{% endblock %}