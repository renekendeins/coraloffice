{% extends 'users/base.html' %}

{% block users_title %}Diving Center Dashboard - CoralOffice{% endblock %}

{% block users_content %}
<h2>{{ user.userprofile.business_name }} Dashboard</h2>

<!-- Upcoming Dives Section -->
<section style="margin-top: 40px; margin-bottom: 50px;">
    <h3 style="color: #333; border-bottom: 2px solid #ddd; padding-bottom: 10px;">🏊‍♂️ Salidas de Hoy y Mañana</h3>
    {% if upcoming_dives %}
        <div style="margin-top: 20px;">
            {% for dive in upcoming_dives %}
            <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; {% if dive.has_special_notes %}border-left: 5px solid #ff5722;{% endif %}">
                <div style="flex: 1;">
                    {% if dive.has_special_notes %}
                        <span style="color: #ff5722; font-size: 18px; margin-right: 10px;" title="Special notes available">⚠️</span>
                    {% endif %}
                    <strong>{{ dive.dive_site }}</strong>
                    <br>
                    <small style="color: #666;">{{ dive.date|date:"l, F j, Y" }} at {{ dive.time|time:"H:i" }}</small>
                    <br>
                    <small style="color: #666;">{{ dive.get_participant_count }}/{{ dive.max_participants }} participants</small>
                    {% if dive.special_notes %}
                        <br>
                        <small style="color: #ff5722;"><strong>Notes:</strong> {{ dive.special_notes|truncatechars:100 }}</small>
                    {% endif %}
                </div>
                <div style="display: flex; gap: 10px;">
                    <a href="{% url 'users:dive_detail' dive.id %}" class="btn" style="background: #4caf50; padding: 5px 10px; font-size: 12px;">View Details</a>
                    <a href="{% url 'users:manage_dive_participants' dive.id %}" class="btn" style="background: #2196f3; padding: 5px 10px; font-size: 12px;">Manage Participants</a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="color: #666; margin-top: 20px;">No dives scheduled for today or tomorrow.</p>
    {% endif %}
</section>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 40px;">
    <!-- Calendar & Scheduling -->
    <section class="card">
        <h3 style="color: #4caf50; border-bottom: 2px solid #4caf50; padding-bottom: 10px;">📅 Calendario</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:calendar_view' %}" class="btn" style="background: #4caf50;">Calendario</a>
            <a href="{% url 'users:schedule_dive' %}" class="btn" style="background: #a5d6a7;">Crear nueva salida</a>
            <!-- <a href="{% url 'users:dive_calendar' %}" class="btn" style="background: #81c784;">Listado de salidas</a> -->
            <a href="{% url 'users:staff_planning' %}" class="btn" style="background: #7986cb;">Planning de mañana</a>
            
        </div>
    </section>
    
    <!-- Customer Management -->
    <section class="card">
        <h3 style="color: #2196f3; border-bottom: 2px solid #2196f3; padding-bottom: 10px;">👥 Clientes</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:add_customer' %}" class="btn" style="background: #2196f3;">Crear nuevo cliente</a>
            <a href="{% url 'users:customer_list' %}" class="btn" style="background: #64b5f6;">Ver todos los clientes</a>
        </div>
    </section>

    <!-- Diving Groups Management -->
    <section class="card">
        <h3 style="color: #795548; border-bottom: 2px solid #795548; padding-bottom: 10px;">👥 Grupos de buceo</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:add_diving_group' %}" class="btn" style="background: #795548;">Crear nuevo grupo</a>
            <a href="{% url 'users:diving_groups_list' %}" class="btn" style="background: #8d6e63;">Gestionar grupos</a>
        </div>
    </section>

    <!-- Activity Management -->
    <section class="card">
        <h3 style="color: #ff9800; border-bottom: 2px solid #ff9800; padding-bottom: 10px;">🏊 Gestor de actividades</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:add_activity' %}" class="btn" style="background: #ff9800;">Crear nueva actividad</a>
            <a href="{% url 'users:activity_list' %}" class="btn" style="background: #ffb74d;">Gestionar actividades</a>
        </div>
    </section>

</div>

<!-- New Management Sections -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 40px;">
    <!-- Diving Sites Management -->
    <section class="card">
        <h3 style="color: #9c27b0; border-bottom: 2px solid #9c27b0; padding-bottom: 10px;">🏝️ Lugares de buceo</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:add_diving_site' %}" class="btn" style="background: #9c27b0;">Crear nuevo lugar</a>
            <a href="{% url 'users:diving_sites_list' %}" class="btn" style="background: #ba68c8;">Gestionar lugares</a>
        </div>
    </section>

    <!-- Inventory Management -->
    <section class="card">
        <h3 style="color: #607d8b; border-bottom: 2px solid #607d8b; padding-bottom: 10px;">📦 Inventario</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:add_inventory_item' %}" class="btn" style="background: #607d8b;">Añadir equipo</a>
            <a href="{% url 'users:inventory_list' %}" class="btn" style="background: #78909c;">Ver inventario</a>
        </div>
    </section>


    <!-- Staff Management -->
    <section class="card">
        <h3 style="color: #3f51b5; border-bottom: 2px solid #3f51b5; padding-bottom: 10px;">👨‍🏫 Staff Management</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:add_staff' %}" class="btn" style="background: #3f51b5;">Add New Staff</a>
            <a href="{% url 'users:staff_list' %}" class="btn" style="background: #5c6bc0;">Manage Staff</a>
            
        </div>
    </section>

    <!-- Medical Forms Management -->
    <section class="card">
        <h3 style="color: #e91e63; border-bottom: 2px solid #e91e63; padding-bottom: 10px;">📋 Medical Forms</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:medical_forms_list' %}" class="btn" style="background: #e91e63;">View Submitted Forms</a>
            <a href="{% url 'users:medical_form' %}" class="btn" style="background: #f06292;" target="_blank">Medical Form Link</a>
        </div>
    </section>

    <!-- Medical Forms Management -->
    <section class="card">
        <h3 style="color: #e91e63; border-bottom: 2px solid #e91e63; padding-bottom: 10px;">📈 Analytics</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="{% url 'users:dashboard_analytics' %}" class="btn" style="background: #f06292;" target="_blank">Analytics</a>
        </div>
    </section>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px;">
    <div class="card" style="background: #e3f2fd; border-left: 5px solid #2196f3;">
        <h3>Total Customers</h3>
        <p style="font-size: 2rem; font-weight: bold; color: #2196f3;">{{ customers.count }}</p>
        <a href="{% url 'users:customer_list' %}" style="color: #2196f3;">Manage Customers →</a>
    </div>

    <div class="card" style="background: #e8f5e8; border-left: 5px solid #4caf50;">
        <h3>Upcoming Dives</h3>
        <p style="font-size: 2rem; font-weight: bold; color: #4caf50;">{{ upcoming_dives.count }}</p>
        <a href="{% url 'users:dive_calendar' %}" style="color: #4caf50;">View Calendar →</a>
    </div>
</div>
{% endblock %}