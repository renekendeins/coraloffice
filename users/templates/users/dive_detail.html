
{% extends 'users/base.html' %}

{% block users_title %}Dive Details - CoralOffice{% endblock %}

{% block users_content %}
<h2>Dive Details: {{ dive.dive_site }}</h2>
<p><strong>Date:</strong> {{ dive.date }} | <strong>Time:</strong> {{ dive.time }}</p>
<p><strong>Max Participants:</strong> {{ dive.max_participants }}</p>
<p><strong>Current Participants:</strong> {{ participants.count }}</p>
{% if dive.description %}
    <p><strong>Description:</strong> {{ dive.description }}</p>
{% endif %}
{% if dive.special_notes %}
    <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 15px 0;">
        <h4 style="color: #856404; margin-top: 0;">⚠️ Important Notes</h4>
        <p style="margin-bottom: 0; white-space: pre-line;">{{ dive.special_notes }}</p>
    </div>
{% endif %}

<!-- Summaries Section -->
{% if participants %}
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 20px 0;">
    <!-- Tank Summary -->
    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff;">
        <h4 style="margin-top: 0; color: #007bff;">🔧 Tank Summary</h4>
        {% regroup participants by tank_size as tank_groups %}
        {% for tank_group in tank_groups %}
            <div style="margin-bottom: 8px;">
                <strong>{{ tank_group.grouper }}:</strong> {{ tank_group.list|length }} tanks
            </div>
        {% endfor %}
    </div>

    <!-- Equipment Summary -->
    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #28a745;">
        <h4 style="margin-top: 0; color: #28a745;">🎽 Equipment Needed</h4>
        <div style="margin-bottom: 5px;"><strong>Wetsuits:</strong> {{ equipment_summary.wetsuits_needed }}</div>
        <div style="margin-bottom: 5px;"><strong>BCDs:</strong> {{ equipment_summary.bcds_needed }}</div>
        <div style="margin-bottom: 5px;"><strong>Regulators:</strong> {{ equipment_summary.regulators_needed }}</div>
        <div style="margin-bottom: 5px;"><strong>Guides needed:</strong> {{ equipment_summary.guides_needed }}</div>
        <div style="margin-bottom: 5px;"><strong>Insurance needed:</strong> {{ equipment_summary.insurance_needed }}</div>
    </div>

    <!-- Activity Summary -->
    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107;">
        <h4 style="margin-top: 0; color: #ffc107;">🏊 Activities</h4>
        {% regroup participants by activity.name as activity_groups %}
        {% for activity_group in activity_groups %}
            <div style="margin-bottom: 8px;">
                <strong>{{ activity_group.grouper }}:</strong> {{ activity_group.list|length }} divers
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<h3>Current Participants ({{ participants.count }}/{{ dive.max_participants }})</h3>
{% if participants %}
<div style="margin-bottom: 20px;">
    {% for participant in participants %}
    <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 5px;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div style="flex: 1;">
                <h4 style="margin: 0 0 10px 0;">{{ participant.customer.first_name }} {{ participant.customer.last_name }}
                    {% if participant.customer.group_memberships.exists %}
                        {% for membership in participant.customer.group_memberships.all %}
                            <span style="background-color: #6f42c1; color: white; padding: 2px 8px; margin-left: 10px; border-radius: 12px; font-size: 11px; font-weight: normal;">
                                👥 {{ membership.group.name }}
                            </span>
                        {% endfor %}
                    {% endif %}
                </h4>
                <p style="margin: 5px 0;"><strong>Certification Level:</strong> {{ participant.customer.get_certification_level_display|default:"Not specified" }}</p>
                <p style="margin: 5px 0;"><strong>Tank Size:</strong> {{ participant.get_tank_size_display }}</p>
                <p style="margin: 5px 0;"><strong>Activity:</strong> {{ participant.activity.name }}</p>
            </div>
        </div>
        <div style="margin-top: 10px;">
            <strong>Equipment Needed:</strong>
            {% if participant.needs_wetsuit %}<span style="background: #4CAF50; color: white; padding: 2px 6px; margin: 2px; border-radius: 3px; font-size: 12px;">Wetsuit</span>{% endif %}
            {% if participant.needs_bcd %}<span style="background: #4CAF50; color: white; padding: 2px 6px; margin: 2px; border-radius: 3px; font-size: 12px;">BCD</span>{% endif %}
            {% if participant.needs_regulator %}<span style="background: #4CAF50; color: white; padding: 2px 6px; margin: 2px; border-radius: 3px; font-size: 12px;">Regulator</span>{% endif %}
            {% if participant.needs_guide %}<span style="background: #4CAF50; color: white; padding: 2px 6px; margin: 2px; border-radius: 3px; font-size: 12px;">Guide</span>{% endif %}
            {% if participant.needs_insurance %}<span style="background: #4CAF50; color: white; padding: 2px 6px; margin: 2px; border-radius: 3px; font-size: 12px;">Insurance</span>{% endif %}
            {% if not participant.needs_wetsuit and not participant.needs_bcd and not participant.needs_regulator and not participant.needs_guide and not participant.needs_insurance %}
                <span style="color: #666;">None</span>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No participants registered for this dive.</p>
{% endif %}

<a href="{% url 'users:manage_dive_participants' dive.id %}" class="btn">Manage Participants</a>
<a href="{% url 'users:dive_calendar' %}" class="btn" style="background: #6c757d;">Back to Calendar</a>
{% endblock %}
