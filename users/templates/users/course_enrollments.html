
{% extends 'users/base.html' %}

{% block users_title %}Course Enrollments - CoralOffice{% endblock %}

{% block users_content %}
<h2>Course Enrollments</h2>

<div style="margin-bottom: 20px;">
    <a href="{% url 'users:enroll_customer_general' %}" class="btn">Enroll Customer</a>
    <a href="{% url 'users:courses_list' %}" class="btn" style="background: #6c757d;">Manage Courses</a>
</div>

<!-- Status Filter -->
<div class="filter-bar">
    <form method="get" style="display: inline;">
        <select name="status" onchange="this.form.submit()">
            <option value="">All Statuses</option>
            {% for value, label in status_choices %}
                <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </form>
    {% if status_filter %}
        <a href="{% url 'users:course_enrollments' %}" class="btn-small">Clear Filter</a>
    {% endif %}
</div>

{% if enrollments %}
    <div class="enrollments-table">
        <table>
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Course</th>
                    <th>Instructor</th>
                    <th>Status</th>
                    <th>Progress</th>
                    <th>Enrollment Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for enrollment in enrollments %}
                    <tr>
                        <td>
                            <a href="{% url 'users:customer_courses' enrollment.customer.id %}">
                                {{ enrollment.customer.get_full_name }}
                            </a>
                        </td>
                        <td>{{ enrollment.course.name }}</td>
                        <td>{{ enrollment.instructor.get_full_name|default:"Not assigned" }}</td>
                        <td>
                            <span class="status-badge status-{{ enrollment.status|lower }}">
                                {{ enrollment.get_status_display }}
                            </span>
                        </td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ enrollment.get_progress_percentage }}%"></div>
                                <span class="progress-text">{{ enrollment.get_completed_dives }}/{{ enrollment.course.total_dives }}</span>
                            </div>
                        </td>
                        <td>{{ enrollment.enrollment_date|date:"M d, Y" }}</td>
                        <td>
                            <a href="{% url 'users:enrollment_detail' enrollment.id %}" class="btn-small">View Details</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p>No enrollments found. <a href="{% url 'users:enroll_customer_general' %}">Enroll a customer</a> to get started.</p>
{% endif %}

<style>
.filter-bar {
    margin-bottom: 20px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
}

.enrollments-table table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

.enrollments-table th,
.enrollments-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.enrollments-table th {
    background: #f8f9fa;
    font-weight: bold;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
}

.status-enrolled { background: #e3f2fd; color: #1976d2; }
.status-in_progress { background: #fff3e0; color: #f57c00; }
.status-completed { background: #e8f5e8; color: #388e3c; }
.status-cancelled { background: #ffebee; color: #d32f2f; }
.status-on_hold { background: #f3e5f5; color: #7b1fa2; }

.progress-bar {
    position: relative;
    width: 100px;
    height: 20px;
    background: #f0f0f0;
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: #28a745;
    border-radius: 10px;
    transition: width 0.3s ease;
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 11px;
    font-weight: bold;
    color: #333;
}

.btn-small {
    display: inline-block;
    padding: 5px 10px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 12px;
}
</style>
{% endblock %}
