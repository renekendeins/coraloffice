
{% extends 'users/base.html' %}

{% block users_title %}{{ enrollment.course.name }} - {{ enrollment.customer.get_full_name }} - CoralOffice{% endblock %}

{% block users_content %}
<h2>{{ enrollment.course.name }}</h2>
<h3>Student: {{ enrollment.customer.get_full_name }}</h3>

<div class="enrollment-info">
    <div class="info-card">
        <h4>Course Information</h4>
        <p><strong>Course Type:</strong> {{ enrollment.course.get_course_type_display }}</p>
        <p><strong>Total Dives:</strong> {{ enrollment.course.total_dives }}</p>
        <p><strong>Instructor:</strong> {{ enrollment.instructor.get_full_name|default:"Not assigned" }}</p>
        <p><strong>Status:</strong> 
            <span class="status-badge status-{{ enrollment.status|lower }}">
                {{ enrollment.get_status_display }}
            </span>
        </p>
        <p><strong>Progress:</strong> {{ enrollment.get_completed_dives }}/{{ enrollment.course.total_dives }} dives completed</p>
        <p><strong>Enrollment Date:</strong> {{ enrollment.enrollment_date|date:"F d, Y" }}</p>
        {% if enrollment.completion_date %}
            <p><strong>Completion Date:</strong> {{ enrollment.completion_date|date:"F d, Y" }}</p>
        {% endif %}
    </div>
</div>

<h4>Course Sessions</h4>
<div class="sessions-list">
    {% for session in sessions %}
        <div class="session-card">
            <div class="session-header">
                <h5>Session {{ session.session_number }}: {{ session.title }}</h5>
                <span class="session-status status-{{ session.status|lower }}">
                    {{ session.get_status_display }}
                </span>
            </div>
            
            <div class="session-details">
                <p><strong>Type:</strong> {{ session.get_session_type_display }}</p>
                {% if session.description %}
                    <p><strong>Description:</strong> {{ session.description }}</p>
                {% endif %}
                {% if session.skills_covered %}
                    <p><strong>Skills Covered:</strong> {{ session.skills_covered }}</p>
                {% endif %}
                
                {% if session.dive_schedule %}
                    <p><strong>Scheduled:</strong> {{ session.dive_schedule.date|date:"M d, Y" }} at {{ session.dive_schedule.time|time:"H:i" }}</p>
                    <p><strong>Location:</strong> {{ session.dive_schedule.dive_site.name }}</p>
                    <a href="{% url 'users:dive_detail' session.dive_schedule.id %}" class="btn-small">View Dive Details</a>
                {% else %}
                    <p><em>Not yet scheduled</em></p>
                    <a href="{% url 'users:schedule_course_session' session.id %}" class="btn-small">Schedule Session</a>
                {% endif %}
                
                {% if session.instructor %}
                    <p><strong>Instructor:</strong> {{ session.instructor.get_full_name }}</p>
                {% endif %}
                
                {% if session.completion_date %}
                    <p><strong>Completed:</strong> {{ session.completion_date|date:"M d, Y H:i" }}</p>
                    {% if session.grade %}
                        <p><strong>Grade:</strong> {{ session.grade }}</p>
                    {% endif %}
                {% endif %}
                
                {% if session.instructor_notes %}
                    <p><strong>Instructor Notes:</strong> {{ session.instructor_notes }}</p>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>

<div style="margin-top: 30px;">
    <a href="{% url 'users:course_enrollments' %}" class="btn">Back to Enrollments</a>
    <a href="{% url 'users:customer_courses' enrollment.customer.id %}" class="btn" style="background: #28a745;">Customer Profile</a>
</div>

<style>
.enrollment-info {
    margin-bottom: 30px;
}

.info-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.sessions-list {
    display: grid;
    gap: 15px;
}

.session-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.session-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.session-header h5 {
    margin: 0;
    color: #333;
}

.session-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
}

.status-scheduled { background: #e3f2fd; color: #1976d2; }
.status-in_progress { background: #fff3e0; color: #f57c00; }
.status-completed { background: #e8f5e8; color: #388e3c; }
.status-cancelled { background: #ffebee; color: #d32f2f; }
.status-rescheduled { background: #f3e5f5; color: #7b1fa2; }

.session-details p {
    margin: 5px 0;
}

.btn-small {
    display: inline-block;
    padding: 5px 10px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 12px;
    margin-right: 5px;
}
</style>
{% endblock %}
